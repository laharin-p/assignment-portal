
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Assignment Submissions</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { background:#f8f9fa; }

.plag-high { background:#f8d7da!important; }
.plag-medium { background:#fff3cd!important; }
.plag-low { background:#d1e7dd!important; }

td,th { vertical-align:middle; }

.file-btn {
    font-size: .85rem;
    min-width: 110px;
}

</style>
</head>

<body>

<div class="container mt-4">

<h3 class="mb-3">
ğŸ“‘ Submissions for: <strong>{{ assignment.title }}</strong>
</h3>

<a href="{{ url_for('teacher_dashboard') }}" class="btn btn-secondary mb-3">
â† Back to Dashboard
</a>

<div class="table-responsive">

<table class="table table-bordered table-hover align-middle">

<thead class="table-dark">
<tr>
    <th>Roll No</th>
    <th>Student Name</th>
    <th>File</th>
    <th>Submitted On</th>
    <th>Plagiarism</th>
</tr>
</thead>

<tbody>

{% if submissions %}

{% for sub in submissions %}

{% if sub.plagiarism_score >= 50 %}
    {% set plag_class = "plag-high" %}
{% elif sub.plagiarism_score >= 20 %}
    {% set plag_class = "plag-medium" %}
{% else %}
    {% set plag_class = "plag-low" %}
{% endif %}

<tr class="{{ plag_class }}">

<td>{{ sub.student.roll_no }}</td>

<td>{{ sub.student.name }}</td>

<td>

<!-- âœ… Mobile + Desktop safe -->
<a href="{{ url_for('direct_file') }}?url={{ sub.file_url }}" 
   target="_blank"
   class="btn btn-success btn-sm file-btn">

   ğŸ“‚ Open / Download

</a>

<br>

<small class="text-muted">
{% set file_ext = sub.file_url.split('.')[-1]|upper %}
Type: {{ file_ext }}
</small>

</td>

<td>{{ sub.submitted_on.strftime('%d-%m-%Y') }}</td>

<td>

{% if sub.plagiarism_score >= 50 %}
<span class="badge bg-danger">{{ sub.plagiarism_score }}%</span>

{% elif sub.plagiarism_score >= 20 %}
<span class="badge bg-warning text-dark">{{ sub.plagiarism_score }}%</span>

{% else %}
<span class="badge bg-success">{{ sub.plagiarism_score }}%</span>
{% endif %}

</td>

</tr>

{% endfor %}

{% else %}
<tr>
<td colspan="5" class="text-center text-muted">
No submissions yet
</td>
</tr>
{% endif %}

</tbody>

</table>

</div>

<!-- FLASH MESSAGES -->

{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}

<div class="position-fixed bottom-0 end-0 p-3" style="z-index:11;">

{% for category, message in messages %}

<div class="alert alert-{{ category }} shadow-sm mb-2">
{{ message }}
</div>

{% endfor %}

</div>

<script>
setTimeout(() => {
  document.querySelectorAll(".alert").forEach(a => a.remove());
}, 4000);
</script>

{% endif %}
{% endwith %}

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>