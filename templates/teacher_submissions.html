
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Assignment Submissions</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background:#f8f9fa; }
.plag-high { background:#f8d7da!important; }   /* >50% */
.plag-medium { background:#fff3cd!important; } /* 20â€“50% */
.plag-low { background:#d1e7dd!important; }    /* <20% */
td,th { vertical-align:middle; }
.file-btn { font-size:.85rem; }
</style>
</head>

<body>

<div class="container mt-4">

<h3 class="mb-3">
ğŸ“‘ Submissions for: <strong>{{ assignment.title }}</strong>
</h3>

<a href="{{ url_for('teacher_dashboard') }}" class="btn btn-secondary mb-3">
â† Back to Dashboard
</a>

<div class="table-responsive">

<table class="table table-bordered table-hover align-middle">

<thead class="table-dark">
<tr>
<th>Roll No</th>
<th>Student Name</th>
<th>File</th>
<th>Submitted On</th>
<th>Plagiarism</th>
</tr>
</thead>

<tbody>

{% for sub in submissions %}

{% if sub.plagiarism_score >= 50 %}
    {% set plag_class = "plag-high" %}
{% elif sub.plagiarism_score >= 20 %}
    {% set plag_class = "plag-medium" %}
{% else %}
    {% set plag_class = "plag-low" %}
{% endif %}

<tr class="{{ plag_class }}">

<td>{{ sub.student.roll_no }}</td>

<td>{{ sub.student.name }}</td>

<td class="d-flex gap-2 flex-wrap">

<!-- Preview link using the file route -->
<a href="{{ url_for('open_file') }}?url={{ sub.file_url }}"
target="_blank"
class="btn btn-success btn-sm file-btn flex-fill">
ğŸ‘ï¸ Preview
</a>

<!-- Direct download link from Cloudinary -->
<a href="{{ sub.file_url }}" 
download="{{ assignment.title|replace(' ', '_') }}_{{ sub.student.roll_no }}_{{ sub.submitted_on.strftime('%Y%m%d') }}.{{ sub.file_url.split('.')[-1] }}"
class="btn btn-secondary btn-sm file-btn flex-fill">
ğŸ“¥ Download
</a>

</td>

<td>{{ sub.submitted_on.strftime('%d-%m-%Y') }}</td>

<td>

{% if sub.plagiarism_score >= 50 %}
<span class="badge bg-danger">{{ sub.plagiarism_score }}%</span>
{% elif sub.plagiarism_score >= 20 %}
<span class="badge bg-warning text-dark">{{ sub.plagiarism_score }}%</span>
{% else %}
<span class="badge bg-success">{{ sub.plagiarism_score }}%</span>
{% endif %}

</td>

</tr>

{% else %}
<tr>
<td colspan="5" class="text-center text-muted">
No submissions yet
</td>
</tr>
{% endfor %}

</tbody>

</table>

</div>

</div>

</body>
</html>