
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Dashboard</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<!-- ðŸ” NAVBAR -->
<nav class="navbar navbar-dark bg-dark px-4">
    <span class="navbar-brand">Student Dashboard</span>
    <a href="{{ url_for('student_logout') }}" class="btn btn-danger btn-sm">Logout</a>
</nav>

<div class="container mt-4">

    <h4 class="mb-3">Available Assignments</h4>

    <table class="table table-bordered table-hover align-middle">
        <thead class="table-dark">
            <tr>
                <th>Title</th>
                <th>Class</th>
                <th>Due Date</th>
                <th>Status</th>
                <th>Assignment</th>
                <th>Submission</th>
            </tr>
        </thead>

        <tbody>
        {% for a in assignments %}

            {% set expired = a.due_date < current_date %}
            {% set submission = submissions.get(a.id) %}

            <tr class="{% if expired %}table-danger{% else %}table-success{% endif %}">
                <!-- ðŸ“˜ TITLE -->
                <td>{{ a.title }}</td>

                <!-- ðŸŽ“ CLASS -->
                <td>{{ a.branch }} {{ a.year }}-{{ a.section }}</td>

                <!-- ðŸ“… DUE DATE -->
                <td>{{ a.due_date.strftime('%d-%m-%Y') }}</td>

                <!-- â° STATUS -->
                <td>
                    {% if expired %}
                        <span class="badge bg-danger">Deadline Crossed</span>
                    {% else %}
                        <span class="badge bg-success">Open</span>
                    {% endif %}
                </td>

                <!-- ðŸ“¥ DOWNLOAD ASSIGNMENT -->
                <td>
                    <a href="{{ a.file_url }}" target="_blank" class="btn btn-sm btn-primary">
                        Download
                    </a>
                </td>

                <!-- ðŸ“¤ SUBMISSION AREA -->
                <td>

                    {% if submission %}
                        <!-- âœ… FILE SUBMITTED -->
                        <span class="badge bg-success mb-1">Submitted</span><br>

                        <!-- ðŸ” PLAGIARISM STATUS -->
                        {% if submission.plagiarism_score is not none %}
                            {% if submission.plagiarism_score > 30 %}
                                <span class="badge bg-danger">
                                    Plagiarism {{ submission.plagiarism_score }}%
                                </span>
                            {% else %}
                                <span class="badge bg-info">
                                    Plagiarism {{ submission.plagiarism_score }}%
                                </span>
                            {% endif %}
                        {% else %}
                            <span class="badge bg-secondary">Plagiarism Pending</span>
                        {% endif %}

                        <br><br>

                        <!-- ðŸ—‘ï¸ DELETE SUBMISSION -->
                        {% if not expired %}
                        <form method="POST"
                              action="{{ url_for('delete_submission', submission_id=submission.id) }}">
                            <button class="btn btn-sm btn-danger">
                                Delete & Re-upload
                            </button>
                        </form>
                        {% endif %}

                    {% else %}

                        {% if expired %}
                            <!-- âŒ DEADLINE OVER -->
                            <span class="text-danger fw-bold">
                                Submission Closed
                            </span>
                        {% else %}
                            <!-- ðŸ“¤ UPLOAD FORM -->
                            <form method="POST"
                                  action="{{ url_for('submit_assignment', assignment_id=a.id) }}"
                                  enctype="multipart/form-data">

                                <input type="file"
                                       name="file"
                                       class="form-control form-control-sm mb-2"
                                       required>

                                <button type="submit"
                                        class="btn btn-sm btn-success">
                                    Submit
                                </button>
                            </form>
                        {% endif %}

                    {% endif %}

                </td>
            </tr>

        {% else %}
            <tr>
                <td colspan="6" class="text-center text-muted">
                    No assignments available
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

</div>

</body>
</html>
