
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Teacher Dashboard | Assignment Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { background:#f8f9fa; }

.badge-status { font-size:.85rem; }

.card-border-red { border-left:5px solid #dc3545!important; }
.card-border-orange { border-left:5px solid #fd7e14!important; }
.card-border-green { border-left:5px solid #198754!important; }

.file-btn { font-size:.85rem; }

details summary{
    cursor:pointer;
    font-weight:500;
}
</style>
</head>

<body>

<!-- ===== NAVBAR ===== -->
<nav class="navbar navbar-dark bg-dark px-3 d-flex justify-content-between">
    <span class="navbar-brand fs-4">Teacher Dashboard</span>

    <span class="text-white d-none d-md-block">
        Welcome, {{ teacher.name }}
    </span>

    <a href="{{ url_for('teacher_logout') }}" class="btn btn-danger btn-sm">
        Logout
    </a>
</nav>

<div class="container mt-4">

<!-- ================= UPLOAD ASSIGNMENT ================= -->
<div class="card shadow p-4 mb-4">

<h4 class="mb-3">ðŸ“¤ Upload Assignment</h4>

<form method="POST"
      action="{{ url_for('teacher_upload') }}"
      enctype="multipart/form-data"
      class="row g-3">

<div class="col-md-6">
<input type="text"
       name="title"
       class="form-control"
       placeholder="Assignment Title"
       required>
</div>

<div class="col-md-2">
<select name="year" class="form-select" required>
<option value="">Year</option>
<option>1</option>
<option>2</option>
<option>3</option>
<option>4</option>
</select>
</div>

<div class="col-md-2">
<select name="branch" class="form-select" required>
<option value="">Branch</option>
<option>CSE</option>
<option>ECE</option>
<option>EEE</option>
<option>AIDS</option>
<option>CSM</option>
<option>CSE-DS</option>
<option>MECH</option>
<option>CIVIL</option>
<option>IT</option>
</select>
</div>

<div class="col-md-2">
<select name="section" class="form-select" required>
<option value="">Section</option>
<option>A</option>
<option>B</option>
<option>C</option>
<option>D</option>
<option>E</option>
</select>
</div>

<div class="col-md-4">
<input type="date"
       name="due_date"
       class="form-control"
       min="{{ current_date }}"
       required>
</div>

<div class="col-md-8">
<input type="file"
       name="file"
       class="form-control"
       required>
</div>

<div class="col-md-12">
<button type="submit" class="btn btn-primary">
Upload Assignment
</button>
</div>

</form>
</div>

<!-- ================= ASSIGNMENTS ================= -->
<div class="card shadow p-4">

<h4 class="mb-3">ðŸ“‹ Assignments</h4>

<!-- ===== MOBILE VIEW ===== -->
<div class="d-md-none">

{% for a in assignments %}

{% set days_left = (a.due_date - current_date).days %}

{% if days_left < 0 %}
    {% set border = "card-border-red" %}
{% elif days_left <= 2 %}
    {% set border = "card-border-orange" %}
{% else %}
    {% set border = "card-border-green" %}
{% endif %}

<div class="card mb-3 {{ border }}">
<div class="card-body">

<h5>{{ a.title }}</h5>

<p class="mb-1">
{{ a.branch }} {{ a.year }}-{{ a.section }}
</p>

<p class="mb-1">
Due: {{ a.due_date.strftime('%d-%m-%Y') }}
</p>

{% if days_left < 0 %}
<span class="badge bg-danger badge-status">Closed</span>
{% elif days_left <= 2 %}
<span class="badge bg-warning text-dark badge-status">Near Deadline</span>
{% else %}
<span class="badge bg-success badge-status">Open</span>
{% endif %}

<p class="mt-2 text-danger fw-semibold">
Pending: {{ pending[a.id] | length }} students
</p>

<details>
<summary>Show Pending Students</summary>
<ul class="mt-2">
{% for s in pending[a.id] %}
<li>{{ s.name }} ({{ s.roll_no }})</li>
{% else %}
<li>All submitted âœ…</li>
{% endfor %}
</ul>
</details>

<div class="mt-3 d-flex gap-2 flex-wrap">

<a href="{{ a.file_url }}" target="_blank"
   class="btn btn-sm btn-primary file-btn flex-fill">
Preview / Open
</a>

<a href="{{ a.file_url }}" download
   class="btn btn-sm btn-secondary file-btn flex-fill">
Download
</a>

<a href="{{ url_for('teacher_submissions', assignment_id=a.id) }}"
   class="btn btn-sm btn-info file-btn flex-fill">
Submissions
</a>

</div>

</div>
</div>

{% else %}
<p class="text-muted text-center">
No assignments uploaded yet
</p>
{% endfor %}

</div>

<!-- ===== DESKTOP VIEW ===== -->
<div class="table-responsive d-none d-md-block">

<table class="table table-bordered table-hover align-middle">

<thead class="table-dark">
<tr>
<th>Title</th>
<th>Class</th>
<th>Due Date</th>
<th>Pending</th>
<th>File</th>
<th>Actions</th>
</tr>
</thead>

<tbody>

{% for a in assignments %}

{% set days_left = (a.due_date - current_date).days %}

<tr class="{% if days_left < 0 %}table-danger
           {% elif days_left <= 2 %}table-warning
           {% else %}table-success{% endif %}">

<td>{{ a.title }}</td>
<td>{{ a.branch }} {{ a.year }}-{{ a.section }}</td>
<td>{{ a.due_date.strftime('%d-%m-%Y') }}</td>

<td>
{{ pending[a.id] | length }}

<details class="mt-1">
<summary>View</summary>
<ul>
{% for s in pending[a.id] %}
<li>{{ s.name }} ({{ s.roll_no }})</li>
{% else %}
<li>All submitted âœ…</li>
{% endfor %}
</ul>
</details>
</td>

<td>

<a href="{{ a.file_url }}" target="_blank"
   class="btn btn-sm btn-primary file-btn">
Preview
</a>

<a href="{{ a.file_url }}" download
   class="btn btn-sm btn-secondary file-btn">
Download
</a>

</td>

<td>

<a href="{{ url_for('teacher_submissions', assignment_id=a.id) }}"
   class="btn btn-info btn-sm file-btn">
View Submissions
</a>

</td>

</tr>

{% else %}
<tr>
<td colspan="6" class="text-center text-muted">
No assignments uploaded yet
</td>
</tr>
{% endfor %}

</tbody>
</table>

</div>

</div>

</div>

</body>
</html>